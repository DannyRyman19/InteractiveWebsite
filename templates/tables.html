{% extends 'layout.html' %}

{% block body %}
<script>
    function editFunction(product_id) {
          var message = 'message'+product_id;
          var quantity = 'quantity'+product_id;

          document.getElementById(message).contentEditable = true;
          document.getElementById(message).style.color = "red" ;

          document.getElementById(quantity).contentEditable = true;
          document.getElementById(quantity).style.color = "red" ;
          document.getElementById(product_id+"edit").disabled = true;
          document.getElementById(product_id+"edit").style.display = "none";  
          document.getElementById(product_id+"save").style.display = "block";  

    }
        function saveFunction(product_id) {
              var message = 'message'+product_id;
              var quantity = 'quantity'+product_id;

              document.getElementById(message).contentEditable = false;
              document.getElementById(message).style.color = "black" ;

              document.getElementById(quantity).contentEditable = false;
              document.getElementById(quantity).style.color = "black" ;
              document.getElementById(product_id+"edit").disabled = false;              
              document.getElementById(product_id+"save").style.display = "none"; 
              document.getElementById(product_id+"edit").style.display = "block"; 
        }
    </script>
    {% if tables.active ==  1 %}
        <h1>Table Number {{id}}<div class="float-right">Seats:<input id="covers" type ="text" style="width: 45px" value="{{tables.covers}}"></div></h1>
        {{order_id}}
        <hr>
        <a class="btn btn-success" href="/tables/{{id}}/orderdrinks">Drinks</a>
            <a class="btn btn-success" href="/tables/{{id}}/orderstarters">Starters</a>
            <a class="btn btn-success" href="/tables/{{id}}/ordermains">Mains</a>
            <a class="btn btn-success" href="/tables/{{id}}/ordersides">Sides</a>
            <a class="btn btn-success" href="./{{id}}/orderdesserts">Desserts</a>
            {% if tables.covers >= 7 %}
                <div><a class="btn btn-danger float-right" href="/tables/closetable/{{id}}/">Close Table</a><h2>Total Bill + 10% Service: £{{tables.totalservice}}</h2><h3>Total Bill £{{tables.total}}</h3></div>
            {% else %}
                <div><a class="btn btn-danger float-right" href="/tables/closetable/{{id}}/">Close Table</a><h2>Total Bill £{{tables.total}}</h2></div>
            {% endif %}
            <input type="button" class="btn btn-primary float-right" onclick="printDiv('printableArea')" value="Print Bill">
            <br>
            <hr>

            <script>
            function printDiv(divName) {
                var printContents = document.getElementById(divName).innerHTML;
                var originalContents = document.body.innerHTML;
                document.body.innerHTML = printContents;
                window.print();

                document.body.innerHTML = originalContents;
                }
            </script>

            <script>
                $(document).ready( function () {
                  $('#all').DataTable();
              } );
                    $(document).ready( function () {
                  $('#drinks').DataTable();
              } );
              $(document).ready( function () {
                  $('#starters').DataTable();
              } );
              $(document).ready( function () {
                  $('#Mains').DataTable();
              } );
              $(document).ready( function () {
                  $('#Sides').DataTable();
              } );
              $(document).ready( function () {
                  $('#Desserts').DataTable();
              } );
            </script>
            <script>
            $(document).ready(function(){
            $('table tr td').on('click', function(){
            $('input[type="text"]',this).css('display','block');
            });    
            });
            </script>
    {% else %}
        <h1>Table Number {{id}}<div class="float-right">Seats:0</div></h1>
        <hr>    
        
            <div class="float-right"><h2>Total Bill £0.00</h2></div><a class="btn btn-primary" href="/tables/opentable/{{id}}/">Open Table</a>
    {% endif %}
    <div>
        
    </div>
    <div id="printableArea" style="display:none; align-content: center;">
        <table class="table table-striped">
            
            <H1 style="align-content: center">Restaurant Name</H1>
            <h4>Tel: 01234 567890</h4>
            
            
                        <tr>
                            <th>Quantity</th>
                            <th>Item</th>
                            <th>Price</th>
                            <th>Subtotal</th>
                        </tr>
                            {% for drink in drinks %}
                        
                        <tr>
                                <td>{{drink.quantity}}</td>
                                <td>{{drink.name}}</td>
                                <td>{{drink.price}}</td>
                                <td>{{drink.subtotal}}</td>
                            </tr>
                            
                            {% endfor %}
    
                            {% for starter in starters %}
                        
                        <tr>
                                <td>{{starter.quantity}}</td>
                                <td>{{starter.name}}</td>
                                <td>{{starter.price}}</td>
                                <td>{{starter.subtotal}}</td>
                            </tr>
                            
                            {% endfor %}
    
                            {% for main in mains %}
                        
                        <tr>
                                <td>{{main.quantity}}</td>
                                <td>{{main.name}}</td>
                                <td>{{main.price}}</td>
                                <td>{{main.subtotal}}</td>
                            </tr>
                            
                            {% endfor %}
    
                            {% for side in sides %}
                        
                        <tr>
                                <td>{{side.quantity}}</td>                            
                                <td>{{side.name}}</td>
                                <td>{{side.price}}</td>
                                <td>{{side.subtotal}}</td>
                            </tr>
                            
                            {% endfor %}
    
                            {% for dessert in desserts %}
                        
                            <tr>
                                <td>{{dessert.quantity}}</td>
                                <td>{{dessert.name}}</td>
                                <td>{{dessert.price}}</td>
                                <td>{{dessert.subtotal}}</td>
                                {% endfor %}
                            </tr>   
        </table>
        <br>
        <br>   
        {% if tables.covers >= 7 %} 
            <div style="text-align:right">
            <h4>Subtotal: £{{tables.total}}</h4>   
            <h4 >10% Service: £{{tables.service}}</h4>  
            <h1>Total: £{{tables.totalservice}}</h1>   
            <p>Bill Number: {{tables.order_id}}</p></div>
        {% else %}
            <h1 class="float-right">Total: £{{tables.total}}</h1>   
            <p>Bill Number: {{tables.order_id}}</p>
        {% endif %}
    </div>
   
    <h3>All Items</h3>
    <table id ="all" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                    </tr>
                </thead>
                <tfoot>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>

                </tfoot>
                <tbody>
                        {% for drink in drinks %}
                    
                    <tr>
                            <td><p class="{{drink.product_id}}quantity" >{{drink.quantity}}</p></td>
                            <td>{{drink.name}}</td>
                            <td class="{{drink.product_id}}message">{{drink.message}}</td>
                            <td>{{drink.price}}</td>
                            <td>{{drink.subtotal}}</td>

                        </tr>
                        
                        {% endfor %}

                        {% for starter in starters %}
                    
                    <tr>
                            <td>{{starter.quantity}}</td>
                            <td>{{starter.name}}</td>
                            <td>{{starter.message}}</td>
                            <td>{{starter.price}}</td>
                            <td>{{starter.subtotal}}</td>
                        </tr>
                        
                        {% endfor %}

                        {% for main in mains %}
                    
                    <tr>
                            <td>{{main.quantity}}</td>
                            <td>{{main.name}}</td>
                            <td>{{main.message}}</td>
                            <td>{{main.price}}</td>
                            <td>{{main.subtotal}}</td>
                        </tr>
                        
                        {% endfor %}

                        {% for side in sides %}
                    
                    <tr>
                            <td>{{side.quantity}}</td>                            
                            <td>{{side.name}}</td>
                            <td>{{side.message}}</td>
                            <td>{{side.price}}</td>
                            <td>{{side.subtotal}}</td>
                        </tr>
                        
                        {% endfor %}

                        {% for dessert in desserts %}
                    
                        <tr>
                            <td>{{dessert.quantity}}</td>
                            <td>{{dessert.name}}</td>
                            <td>{{dessert.message}}</td>
                            <td>{{dessert.price}}</td>
                            <td>{{dessert.subtotal}}</td>
                        </tr>
                            
                        {% endfor %}
                    
                </tbody>   
    </table>
    <hr>
    <h3>Drinks</h3>
    <table id ="drinks" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tfoot>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                        <th></th>
                </tfoot>
                <tbody>
                        {% for drink in drinks %}
                    
                    <tr>
                            <form id = "Form{{drink.product_id}}" action = "/tables/{{tables.table_id}}/add_to_order/{{order_id}}/{{drink.product_id}}/{{drink.price}}/" method = "POST">
                            <td id="quantity{{drink.product_id}}" name="quantity{{drink.product_id}}">{{drink.quantity}}</td>
                            <td>{{drink.name}}</td>
                            <td id="message{{drink.product_id}}" name="message{{drink.product_id}}">{{drink.message}}</td>
                            <td>{{drink.price}}</td>
                            <td>{{drink.subtotal}}</td>
                            <td><button id="{{drink.product_id}}edit" onclick="editFunction('{{drink.product_id}}')">Edit</button><button style="display: none" id="{{drink.product_id}}save" onclick="saveFunction('{{drink.product_id}}')" type="submit">Save</button></td>
                            </form>
                            <td>
                                    <form action="{{url_for('remove_order',id=drink.product_id, order_id = order_id,table_id = tables.table_id)}}" method="POST">
                                            <button type="button" onclick="document.getElementById('deleteForm').action = '/remove_order/{{drink.product_id}}/{{order_id}}/{{tables.table_id}}';" class="btn btn-danger " data-toggle="modal" data-target="#myModal">x</button>
                                    </form>
                            </td>
                        </tr>
                       
                    
                        
                        {% endfor %}
                    
                </tbody>   
    </table>

    <hr>
    <h3>Starters</h3>
    <table id = "starters" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                    </tr>
                </thead>
                <tfoot>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                </tfoot>
                <tbody>
                        {% for starter in starters %}
                    
                    <tr>
                            <td id="quantity{{starter.product_id}}">{{starter.quantity}}</td>
                            <td>{{starter.name}}</td>
                            <td id="message{{starter.product_id}}">{{starter.message}}</td>
                            <td>{{starter.price}}</td>
                            <td>{{starter.subtotal}}</td>
                            <td><button id="{{starter.product_id}}edit" onclick="editFunction('{{starter.product_id}}')">Edit</button><button style="display: none" id="{{starter.product_id}}save" onclick="saveFunction('{{starter.product_id}}')">Save</button></td>

                        </tr>
                        {% endfor %}
                    
                </tbody>   
    </table>

    <hr>
    <h3>Mains</h3>
    <table id = "Mains" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                    </tr>
                </thead>
                <tfoot>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                </tfoot>
                <tbody>
                   
                        {% for main in mains %}
                    <tr>
                            <td id="{{main.product_id}}quantity">{{main.quantity}}</td>
                            <td>{{main.name}}</td>
                            <td id="{{main.product_id}}message">{{main.message}}</td>
                            <td>{{main.price}}</td>
                            <td>{{main.subtotal}}</td>
                            <td><button id="{{main.product_id}}edit" onclick="editFunction('{{main.product_id}}')">Edit</button><button style="display: none" id="{{main.product_id}}save" onclick="saveFunction('{{main.product_id}}')">Save</button></td>

                    </tr>
                    
                    {% endfor %}
                    
                </tbody>   
       
          
    </table>

    <hr>
    <h3>Sides</h3>
    <table id ="Sides" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                    </tr>
                </thead>
                <tfoot>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                </tfoot>
                <tbody>
                   
                        {% for side in sides %}
                    <tr>
                        <td id="{{side.product_id}}quantity">{{side.quantity}}</td>                                          
                        <td>{{side.name}}</td>
                        <td id="{{side.product_id}}message">{{side.message}}</td>
                        <td>{{side.price}}</td>
                        <td>{{side.subtotal}}</td>
                        <td><button id="{{side.product_id}}edit" onclick="editFunction('{{side.product_id}}')">Edit</button><button style="display: none" id="{{side.product_id}}save" onclick="saveFunction('{{side.product_id}}')">Save</button></td>

                    </tr>
                    
                    {% endfor %}
                    
                </tbody>   
       
    </table>

    <hr>
    <h3>Desserts</h3>
    <table id="Desserts"class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                    </tr>
                </thead>
                <tfoot>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Message</th>
                        <th>Price</th>
                        <th>Sub Total</th>
                        <th></th>
                </tfoot>
                <tbody>
                   
                        {% for dessert in desserts %}
                    <tr>
                        <td id="{{dessert.product_id}}quantity">{{dessert.quantity}}</td>                        
                        <td>{{dessert.name}}</td>
                        <td id="{{dessert.product_id}}message">{{dessert.message}}</td>
                        <td>{{dessert.price}}</td>
                        <td>{{dessert.subtotal}}</td>
                        <td><button id="{{dessert.product_id}}edit" onclick="editFunction('{{dessert.product_id}}')">Edit</button><button style="display: none" id="{{dessert.product_id}}save" onclick="saveFunction('{{dessert.product_id}}')">Save</button></td>

                    </tr>
                    
                    {% endfor %}
                    
                </tbody>   
    </table>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
                <h3>Remove from table</h3>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to remove this product from the table?</p>
            </div>
            <div class="modal-footer">
                    <form id="deleteForm" action="" method="POST">
                            <input type="hidden" name="_method" value="DELETE">
                            <input type="submit" value="Delete" class="btn btn-danger">
                            <button type="" class="btn btn-primary" data-dismiss="modal">Cancel </button>
        
                    </form>
                    
            </div>
          </div>
          
        </div>
      </div>
      
{% endblock %}